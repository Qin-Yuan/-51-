C51 COMPILER V9.54   DS1302                                                                04/01/2021 19:40:02 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE DS1302
OBJECT MODULE PLACED IN .\Objects\ds1302.obj
COMPILER INVOKED BY: E:\Kiel 5\C51\BIN\C51.EXE ds1302.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ds1
                    -302.lst) TABS(2) OBJECT(.\Objects\ds1302.obj)

line level    source

   1          #include<reg52.h>
   2          #include<intrins.h>
   3          
   4          //---¶¨Òåds1302Ê¹ÓÃµÄIO¿Ú---//
   5          sbit DSIO=P1^2;
   6          sbit RST=P1^3;
   7          sbit SCLK=P1^1;
   8          
   9          //---DS1302Ð´ÈëºÍ¶ÁÈ¡Ê±·ÖÃëµÄµØÖ·ÃüÁî---//
  10          //---Ãë·ÖÊ±ÈÕÔÂÖÜÄê ×îµÍÎ»¶ÁÐ´Î»;-------//
  11          //                              Ãë    ·Ö    Ê±    ÈÕ    ÔÂ    ÖÜ    Äê
  12          uchar code READ_RTC_ADDR[7] = {0x81, 0x83, 0x85, 0x87, 0x89, 0x8b, 0x8d}; 
  13          uchar code WRITE_RTC_ADDR[7] = {0x80, 0x82, 0x84, 0x86, 0x88, 0x8a, 0x8c};
  14          
  15          //---DS1302Ê±ÖÓ³õÊ¼»¯2021Äê3ÔÂ25ÈÕÐÇÆÚÁù12µã00·Ö00Ãë¡£---//
  16          //---´æ´¢Ë³ÐòÊÇÃë·ÖÊ±ÈÕÔÂÖÜÄê,´æ´¢¸ñÊ½ÊÇÓÃBCDÂë---//
  17          //È«¾Ö±äÁ¿               Ãë    ·Ö    Ê±    ÈÕ    ÔÂ    ÖÜ    Äê            
  18          extern uchar TIME[7] = {0x10, 0x40, 0x23, 0x25, 0x03, 0x06, 0x21};
  19          
  20          /*******************************************************************************
  21          * º¯ Êý Ãû         : Ds1302Write
  22          * º¯Êý¹¦ÄÜ       : ÏòDS1302ÃüÁî£¨µØÖ·+Êý¾Ý£©
  23          * Êä    Èë         : addr,dat
  24          * Êä    ³ö         : ÎÞ
  25          *******************************************************************************/
  26          
  27          void Ds1302Write(uchar addr, uchar dat)
  28          {
  29   1        uchar n;
  30   1        RST = 0;
  31   1        _nop_();
  32   1      
  33   1        SCLK = 0;//ÏÈ½«SCLKÖÃµÍµçÆ½¡£
  34   1        _nop_();
  35   1        RST = 1; //È»ºó½«RST(CE)ÖÃ¸ßµçÆ½¡£
  36   1        _nop_();
  37   1      
  38   1        for (n=0; n<8; n++)//¿ªÊ¼´«ËÍ°ËÎ»µØÖ·ÃüÁî
  39   1        {
  40   2          DSIO = addr & 0x01;//Êý¾Ý´ÓµÍÎ»¿ªÊ¼´«ËÍ
  41   2          addr >>= 1;
  42   2          SCLK = 1;//Êý¾ÝÔÚÉÏÉýÑØÊ±£¬DS1302¶ÁÈ¡Êý¾Ý
  43   2          _nop_();
  44   2          SCLK = 0;
  45   2          _nop_();
  46   2        }
  47   1        for (n=0; n<8; n++)//Ð´Èë8Î»Êý¾Ý
  48   1        {
  49   2          DSIO = dat & 0x01;
  50   2          dat >>= 1;
  51   2          SCLK = 1;//Êý¾ÝÔÚÉÏÉýÑØÊ±£¬DS1302¶ÁÈ¡Êý¾Ý
  52   2          _nop_();
  53   2          SCLK = 0;
  54   2          _nop_();  
C51 COMPILER V9.54   DS1302                                                                04/01/2021 19:40:02 PAGE 2   

  55   2        } 
  56   1           
  57   1        RST = 0;//´«ËÍÊý¾Ý½áÊø
  58   1        _nop_();
  59   1      }
  60          
  61          /*******************************************************************************
  62          * º¯ Êý Ãû         : Ds1302Read
  63          * º¯Êý¹¦ÄÜ       : ¶ÁÈ¡Ò»¸öµØÖ·µÄÊý¾Ý
  64          * Êä    Èë         : addr
  65          * Êä    ³ö         : dat
  66          *******************************************************************************/
  67          
  68          uchar Ds1302Read(uchar addr)
  69          {
  70   1        uchar n,dat,dat1;
  71   1        RST = 0;
  72   1        _nop_();
  73   1      
  74   1        SCLK = 0;//ÏÈ½«SCLKÖÃµÍµçÆ½¡£
  75   1        _nop_();
  76   1        RST = 1;//È»ºó½«RST(CE)ÖÃ¸ßµçÆ½¡£
  77   1        _nop_();
  78   1      
  79   1        for(n=0; n<8; n++)//¿ªÊ¼´«ËÍ°ËÎ»µØÖ·ÃüÁî
  80   1        {
  81   2          DSIO = addr & 0x01;//Êý¾Ý´ÓµÍÎ»¿ªÊ¼´«ËÍ
  82   2          addr >>= 1;
  83   2          SCLK = 1;//Êý¾ÝÔÚÉÏÉýÑØÊ±£¬DS1302¶ÁÈ¡Êý¾Ý
  84   2          _nop_();
  85   2          SCLK = 0;//DS1302ÏÂ½µÑØÊ±£¬·ÅÖÃÊý¾Ý
  86   2          _nop_();
  87   2        }
  88   1        _nop_();
  89   1        for(n=0; n<8; n++)//¶ÁÈ¡8Î»Êý¾Ý
  90   1        {
  91   2          dat1 = DSIO;//´Ó×îµÍÎ»¿ªÊ¼½ÓÊÕ
  92   2          dat = (dat>>1) | (dat1<<7);
  93   2          SCLK = 1;
  94   2          _nop_();
  95   2          SCLK = 0;//DS1302ÏÂ½µÑØÊ±£¬·ÅÖÃÊý¾Ý
  96   2          _nop_();
  97   2        }
  98   1      
  99   1        RST = 0;
 100   1        _nop_();  //ÒÔÏÂÎªDS1302¸´Î»µÄÎÈ¶¨Ê±¼ä,±ØÐëµÄ¡£
 101   1        SCLK = 1;
 102   1        _nop_();
 103   1        DSIO = 0;
 104   1        _nop_();
 105   1        DSIO = 1;
 106   1        _nop_();
 107   1        return dat; 
 108   1      }
 109          
 110          /*******************************************************************************
 111          * º¯ Êý Ãû         : Ds1302Init
 112          * º¯Êý¹¦ÄÜ       : ³õÊ¼»¯DS1302.
 113          * Êä    Èë         : ÎÞ
 114          * Êä    ³ö         : ÎÞ
 115          *******************************************************************************/
 116          
C51 COMPILER V9.54   DS1302                                                                04/01/2021 19:40:02 PAGE 3   

 117          void Ds1302Init()
 118          {
 119   1        uchar n;
 120   1        Ds1302Write(0x8E,0X00);    //½ûÖ¹Ð´±£»¤£¬¾ÍÊÇ¹Ø±ÕÐ´±£»¤¹¦ÄÜ
 121   1        for (n=0; n<7; n++)//Ð´Èë7¸ö×Ö½ÚµÄÊ±ÖÓÐÅºÅ£º·ÖÃëÊ±ÈÕÔÂÖÜÄê
 122   1        {
 123   2          Ds1302Write(WRITE_RTC_ADDR[n],TIME[n]); 
 124   2        }
 125   1        Ds1302Write(0x8E,0x80);    //´ò¿ªÐ´±£»¤¹¦ÄÜ
 126   1      }
 127          
 128          /*******************************************************************************
 129          * º¯ Êý Ãû         : Ds1302ReadTime
 130          * º¯Êý¹¦ÄÜ       : ¶ÁÈ¡Ê±ÖÓÐÅÏ¢
 131          * Êä    Èë         : ÎÞ
 132          * Êä    ³ö         : ÎÞ
 133          *******************************************************************************/
 134          
 135          void Ds1302ReadTime()
 136          {
 137   1        uchar n;
 138   1        for (n=0; n<7; n++)//¶ÁÈ¡7¸ö×Ö½ÚµÄÊ±ÖÓÐÅºÅ£º·ÖÃëÊ±ÈÕÔÂÖÜÄê
 139   1        {
 140   2          TIME[n] = Ds1302Read(READ_RTC_ADDR[n]);
 141   2        } 
 142   1      }
 143          
 144          
 145          //¶¨ÒåIO¿Ú
 146          sbit relay1 = P2^2;  //Ë®Ñ­»·¼ÌµçÆ÷
 147          sbit relay2 = P2^1;  //¼ÓÈÈ¼ÌµçÆ÷
 148          sbit relay3 = P2^0;  //³äÑõ¼ÌµçÆ÷
 149          
 150          //ÑÓÊ±º¯Êý
 151          void delayms( uint ms )
 152          {
 153   1        uchar i;
 154   1        while ( ms-- )
 155   1        {
 156   2          for (i=0;i<120;i++);
 157   2        }
 158   1      }
 159          
 160          void main()
 161          {
 162   1        Ds1302Init();
 163   1        while(1)
 164   1        {
 165   2          Ds1302ReadTime(); //Ê±ÖÓTIME
 166   2          if(TIME[0]==20)
 167   2          {
 168   3            relay1=0;
 169   3            delayms(3000);
 170   3          }
 171   2          else if(TIME[0]==25)
 172   2          {
 173   3            relay2=0;
 174   3            delayms(3000);
 175   3          }
 176   2          else if(TIME[0]==33)
 177   2          {
 178   3            relay3=0;
C51 COMPILER V9.54   DS1302                                                                04/01/2021 19:40:02 PAGE 4   

 179   3            delayms(3000);
 180   3          }
 181   2          else if(TIME[0]==37)
 182   2          {
 183   3            relay1 = 1;  //Ë®Ñ­»·¼ÌµçÆ÷
 184   3            relay2 = 1;  //¼ÓÈÈ¼ÌµçÆ÷
 185   3            relay3 = 1;  //³äÑõ¼ÌµçÆ
 186   3          }
 187   2        }
 188   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    259    ----
   CONSTANT SIZE    =     14    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
